<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OAPP v3</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#003264">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="icon-192.png">
    <!-- PWA iOS settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="OAPP v3">
</head>

<body>

    <div id="app">
        <!-- Zapotrzebowania View -->
        <div id="view-orders" class="view active">
            <header>
                <h1>Zapotrzebowania</h1>
                <button id="refresh-orders" class="refresh-btn" aria-label="Od≈õwie≈º">‚Üª</button>
            </header>

            <div class="content">
                <section class="add-form-section">
                    <button class="toggle-form-btn" onclick="toggleForm('orders-form-container')">+ Nowe
                        Zapotrzebowanie</button>
                    <div id="orders-form-container" class="form-container hidden">
                        <form id="orders-form">
                            <div class="form-group">
                                <input type="text" name="co" placeholder="Co potrzeba? *" required>
                            </div>
                            <div class="form-row">
                                <input type="text" name="ilosc" placeholder="Ilo≈õƒá *" required>
                                <input type="text" name="producent" placeholder="Producent">
                            </div>
                            <div class="form-group">
                                <input type="text" name="autor" class="input-autor" placeholder="Autor (opcjonalnie)">
                            </div>
                            <textarea name="uwagi" placeholder="Uwagi (opcjonalnie)"></textarea>
                            <div class="form-group file-upload-group">
                                <label for="order-file" class="file-upload-label">
                                    üì∑ Dodaj zdjƒôcie
                                </label>
                                <input type="file" id="order-file" name="file" accept="image/*">
                                <span id="order-file-name" class="file-name"></span>
                            </div>
                            <button type="submit" class="submit-btn">Dodaj</button>
                        </form>
                    </div>
                </section>

                <div class="kanban-board" id="orders-board">
                    <!-- Columns will be injected by JS -->
                </div>
            </div>
        </div>

        <!-- Pytania View -->
        <div id="view-items" class="view">
            <header>
                <h1>Pytania</h1>
                <button id="refresh-items" class="refresh-btn" aria-label="Od≈õwie≈º">‚Üª</button>
            </header>

            <div class="content">
                <section class="add-form-section">
                    <button class="toggle-form-btn" onclick="toggleForm('items-form-container')">+ Nowe Pytanie</button>
                    <div id="items-form-container" class="form-container hidden">
                        <form id="items-form">
                            <div class="form-group">
                                <input type="text" name="opis" placeholder="Tre≈õƒá pytania *" required>
                            </div>
                            <div class="form-row">
                                <input type="date" name="termin_odpowiedzi" placeholder="Termin">
                                <select name="priorytet">
                                    <option value="Niski">Niski</option>
                                    <option value="≈öredni" selected>≈öredni</option>
                                    <option value="Wysoki">Wysoki</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <input type="text" name="autor" class="input-autor" placeholder="Autor (opcjonalnie)">
                            </div>
                            <button type="submit" class="submit-btn">Dodaj</button>
                        </form>
                    </div>
                </section>

                <div class="kanban-board" id="items-board">
                    <!-- Columns will be injected by JS -->
                </div>
            </div>
        </div>

        <!-- Pliki View -->
        <div id="view-docs" class="view">
            <header>
                <h1>Pliki (Drive)</h1>
            </header>
            <div class="content docs-content">
                <div class="drive-embed-container">
                    <iframe src="https://drive.google.com/embeddedfolderview?id=1iURUi0OKIleXiPBbYsfZSKutvIRBJWmS#grid"
                        class="drive-frame" title="Pliki Google Drive" allowfullscreen>
                    </iframe>
                </div>
                <a href="https://drive.google.com/drive/folders/1iURUi0OKIleXiPBbYsfZSKutvIRBJWmS?usp=sharing"
                    target="_blank" class="drive-btn">
                    üìÇ Otw√≥rz folder w Google Drive
                </a>
            </div>
        </div>

        <!-- Chat AI View -->
        <div id="view-chat" class="view">
            <header>
                <h1>Chat AI (NotebookLM)</h1>
            </header>
            <div class="content chat-content">
                <p class="section-hint">Twoje notesy:</p>
                <div id="notebooks-list-display" class="notebooks-grid">
                    <!-- Buttons will be injected here -->
                </div>
                <div class="empty-state-hint" id="notebooks-empty-hint" style="display:none;">
                    Brak notes√≥w. Dodaj je w Ustawieniach.
                </div>
            </div>
        </div>

        <!-- Ustawienia View -->
        <div id="view-settings" class="view">
            <header>
                <h1>Ustawienia</h1>
            </header>
            <div class="content settings-content">

                <!-- User Section -->
                <div class="settings-card">
                    <h2>üë§ U≈ºytkownik</h2>
                    <div class="setting-group">
                        <label for="user-name-input">Podpis (Imiƒô/Nazwisko)</label>
                        <input type="text" id="user-name-input" placeholder="Wpisz swoje dane...">
                        <p class="setting-hint">To pole bƒôdzie automatycznie wype≈Çniaƒá "Autora" w formularzach.</p>
                        <button id="save-user-btn" class="save-settings-btn primary">Zapisz podpis</button>
                    </div>
                </div>

                <!-- Connection Section -->
                <div class="settings-card">
                    <h2>üì° Po≈ÇƒÖczenie</h2>
                    <div class="setting-group">
                        <div class="connection-status-area">
                            <button id="test-connection-btn" class="test-conn-btn">Testuj po≈ÇƒÖczenie z n8n</button>
                        </div>
                    </div>
                </div>

                <!-- Notebooks Section -->
                <div class="settings-card">
                    <h2>ü§ñ Notebooki AI</h2>
                    <p class="setting-hint">Dodaj linki do swoich notes√≥w NotebookLM, aby mieƒá do nich szybki dostƒôp w
                        zak≈Çadce Chat AI.</p>

                    <ul id="settings-notebooks-list" class="settings-list"></ul>

                    <button class="add-link-btn" onclick="addNewNotebook()">+ Dodaj Notebook</button>
                </div>

                <!-- Links Section -->
                <div class="settings-card">
                    <h2>üîó Wa≈ºne Linki</h2>
                    <ul id="links-list" class="settings-list"></ul>
                    <button class="add-link-btn" onclick="addNewLink()">+ Dodaj Link</button>
                </div>

            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-btn active" data-target="view-orders">
                <span class="icon">üì¶</span>
                <span class="label">Zapotrzebowania</span>
            </button>
            <button class="nav-btn" data-target="view-items">
                <span class="icon">‚ùì</span>
                <span class="label">Pytania</span>
            </button>
            <button class="nav-btn" data-target="view-docs">
                <span class="icon">üìÇ</span>
                <span class="label">Pliki</span>
            </button>
            <button class="nav-btn" data-target="view-chat">
                <span class="icon">ü§ñ</span>
                <span class="label">Chat AI</span>
            </button>
            <button class="nav-btn" data-target="view-settings">
                <span class="icon">‚öôÔ∏è</span>
                <span class="label">Ustawienia</span>
            </button>
        </nav>
    </div>

    <div id="toast-container"></div>

    <script src="storage.js"></script>
    <script src="api.js"></script>
    <script src="app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => {
                        console.log('[OAPP] SW registered!', reg);
                        reg.addEventListener('updatefound', () => {
                            const newWorker = reg.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('[OAPP] New version initialized');
                                }
                            });
                        });
                    })
                    .catch(err => console.log('[OAPP] SW registration failed', err));
            });
        }
    </script>
</body>

</html>